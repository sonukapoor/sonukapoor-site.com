<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="copyright" content="© Sonu Kapoor">
  <meta name="publisher" content="Sonu Kapoor">
  <meta name="author" content="Sonu Kapoor">
  {% include head.html %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Sonu Kapoor",
    "jobTitle": "Software Engineer, Google Developer Expert (Angular)",
    "url": "{{ site.url }}",
    "sameAs": [
      "https://www.linkedin.com/in/sonu-kapoor/",
      "https://github.com/sonukapoor"
    ],
    "award": [
      "Microsoft MVP (Developer Technology) 2005–2010, 2024–2026",
      "Google Developer Expert (Angular)"
    ]
  }
  </script>
</head>
<body>
  <a class="skip" href="#main">Skip to content</a>
  {% include header.html %}
  <main id="main" class="container">
    {{ content }}
  </main>
  {% include footer.html %}

  <script>
  (function () {
    const body = document.body;
    const toggle = document.querySelector('.nav-toggle');
    const nav = document.getElementById('siteNav');
    const overlay = document.querySelector('.nav-overlay');

    if (!toggle || !nav) return;

    const isOpen = () => body.getAttribute('data-nav-open') === 'true';

    function openNav() {
      body.setAttribute('data-nav-open', 'true');
      toggle.setAttribute('aria-expanded', 'true');
      nav.setAttribute('aria-hidden', 'false');
      body.style.overflow = 'hidden'; // lock scroll
    }

    function closeNav() {
      body.removeAttribute('data-nav-open');
      toggle.setAttribute('aria-expanded', 'false');
      nav.setAttribute('aria-hidden', 'true');
      body.style.overflow = '';
    }

    toggle.addEventListener('click', () => {
      isOpen() ? closeNav() : openNav();
    });

    overlay?.addEventListener('click', closeNav);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen()) closeNav();
    });

    // Close after navigating (nice on single-page sections)
    nav.addEventListener('click', (e) => {
      if (e.target.closest('a') && window.matchMedia('(max-width: 900px)').matches) closeNav();
    });

    // NEW: click outside (covers any area not in the drawer or toggle)
    function handleOutsidePointer(e) {
      if (!isOpen()) return;
      const t = e.target;
      const clickedInsideNav = nav.contains(t);
      const clickedToggle = toggle.contains(t);
      if (!clickedInsideNav && !clickedToggle) closeNav();
    }
    document.addEventListener('pointerdown', handleOutsidePointer, { passive: true });
    // Fallback for older browsers that don’t support Pointer Events well
    document.addEventListener('touchstart', handleOutsidePointer, { passive: true });

    // NEW: close if resizing above breakpoint (prevents stuck "open" state)
    const mq = window.matchMedia('(min-width: 901px)');
    mq.addEventListener?.('change', (e) => { if (e.matches && isOpen()) closeNav(); });
    // legacy Safari fallback
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 901 && isOpen()) closeNav();
    }, { passive: true });
  })();
</script>


</body>
</html>
